<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ogdcinside</title>

  <link rel="stylesheet" href="styles.css">

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA1O1mJelZT2uZH0308xe3IGNMicJQQQok",
      authDomain: "ogamdo-131e5.firebaseapp.com",
      projectId: "ogamdo-131e5",
      storageBucket: "ogamdo-131e5.firebasestorage.app",
      messagingSenderId: "662198194109",
      appId: "1:662198194109:web:277064ed01fb3c64b4ccd4",
      measurementId: "G-NJQLPC7KJS"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentUserName = "";

    window.startChat = function startChat() {
      const username = document.getElementById("username").value;
      if (username.trim() !== "") {
        currentUserName = username;
        document.getElementById("username-container").style.display = 'none';
        document.getElementById("chat-container").style.display = 'block';
        loadMessages();
      } else {
        alert("사용자명을 입력해주세요.");
      }
    };

    window.sendMessage = async function sendMessage() {
      const message = document.getElementById("chat-input").value;
      if (message.trim() !== "") {
        try {
          await addDoc(collection(db, 'messages'), {
            username: currentUserName,
            message: message,
            timestamp: new Date().toISOString()
          });
          document.getElementById("chat-input").value = '';
        } catch (error) {
          console.error("메시지 전송 오류:", error);
        }
      }
    };

    window.loadMessages = function loadMessages() {
      const messagesContainer = document.getElementById("messages");
      const messagesQuery = query(collection(db, 'messages'), orderBy("timestamp"));

      onSnapshot(messagesQuery, (querySnapshot) => {
        messagesContainer.innerHTML = '';
        querySnapshot.forEach(doc => {
          const messageData = doc.data();
          const messageElement = document.createElement('div');
          messageElement.classList.add('chat-message');

          // 이모지 이름 변환
          let messageText = messageData.message;
          const emojiRegex = /:(\w+):/g; // :로 시작하고, 알파벳+숫자 조합

          messageText = messageText.replace(emojiRegex, (match, emojiName) => {
            return `<img src="${emojiName}.jpg" class="emoji">`;  // 이모지 이름에 맞는 이미지를 삽입
          });

          messageElement.innerHTML = `<span class="username">${messageData.username}:</span> ${messageText}`;
          messagesContainer.appendChild(messageElement);
        });

        // 자동으로 스크롤을 맨 아래로 내리기
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      });
    };

    window.toggleEmoji = function toggleEmoji() {
      const emojiContainer = document.getElementById("emoji-container");
      emojiContainer.style.display = emojiContainer.style.display === 'block' ? 'none' : 'block';
    };

    window.insertEmoji = function insertEmoji(emojiName) {
      const emojiInput = document.getElementById("chat-input");
      emojiInput.value += `:${emojiName}:`;  // 이모지 이름으로 텍스트 삽입
      toggleEmoji();
    };
  </script>
</head>
<body>
  <h1>오감도 갤러리</h1>

  <div id="username-container">
    <input type="text" id="username" placeholder="사용자명" required>
    <button onclick="startChat()">채팅 시작</button>
  </div>

  <div id="chat-container" style="display:none;">
    <div id="messages"></div>
    <div id="message-box">
      <textarea id="chat-input" placeholder="메시지를 입력하세요..." rows="3" onkeydown="if(event.key === 'Enter'){sendMessage(); return false;}"></textarea>
      <button onclick="sendMessage()">전송</button>
      <button onclick="toggleEmoji()">이모지</button>
    </div>
    <div id="emoji-container" style="display: none;">
      <img src="yoon_jot_ga.jpg" class="preview" onclick="insertEmoji('yoon_jot_ga')">
      <img src="yoon_jot_dem.jpg" class="preview" onclick="insertEmoji('yoon_jot_dem')">
      <img src="yoon_frustration.jpg" class="preview" onclick="insertEmoji('yoon_frustration3')">
      <img src="yoon_A0.jpg" class="preview" onclick="insertEmoji('yoon_A0')">
      <img src="yoon_lightoff.jpg" class="preview" onclick="insertEmoji('yoon_lightoff')">
      <img src="yoon_fuckingno.jpg" class="preview" onclick="insertEmoji('yoon_fuckingno')">
      <img src="yoon_greatjob.jpg" class="preview" onclick="insertEmoji('yoon_greatjob')">
      <img src="yoon_yourmom.jpg" class="preview" onclick="insertEmoji('yoon_yourmom')">
      <img src="yoon_please.jpg" class="preview" onclick="insertEmoji('yoon_please')">
      <img src="yoon_wtf.jpg" class="preview" onclick="insertEmoji('yoon_wtf')">
      <img src="yoon_idk.jpg" class="preview" onclick="insertEmoji('yoon_idk')">
      <img src="yoon_jiralno.jpg" class="preview" onclick="insertEmoji('yoon_jiralno')">
      <img src="yoon_nonsense.jpg" class="preview" onclick="insertEmoji('yoon_nonsense')">
      <img src="yoon_dragon.jpg" class="preview" onclick="insertEmoji('yoon_dragon')">
      <img src="yoon_gaechu.jpg" class="preview" onclick="insertEmoji('yoon_gaechu')">
      <img src="yoon_Tlqkf.jpg" class="preview" onclick="insertEmoji('yoon_Tlqkf')">
      <img src="yoon_alive.jpg" class="preview" onclick="insertEmoji('yoon_alive')">
      <img src="yoon_pee.jpg" class="preview" onclick="insertEmoji('yoon_pee')">
      <img src="yoon_disorder.jpg" class="preview" onclick="insertEmoji('yoon_disorder')">
      <img src="yoon_cant_follow.jpg" class="preview" onclick="insertEmoji('yoon_cant_follow')">
    </div>
  </div>
</body>
</html>
